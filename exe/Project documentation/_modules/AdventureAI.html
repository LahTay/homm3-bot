
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AdventureAI &#8212; homm3-bot 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for AdventureAI</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module is responsible for decision making of our agent on the adventure map.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">image_processing.adventure_image_processing</span>
<span class="kn">from</span> <span class="nn">Adventure_AI.AdventureAI_Map_Init</span> <span class="kn">import</span> <span class="n">initMap</span>
<span class="kn">from</span> <span class="nn">GUI_handling.AdventureGUI</span> <span class="kn">import</span> <span class="n">center_on_hero</span><span class="p">,</span> <span class="n">move_to_tile_adventure</span><span class="p">,</span> <span class="n">next_hero</span><span class="p">,</span> <span class="n">move_camera_right</span><span class="p">,</span> \
    <span class="n">move_camera_left</span><span class="p">,</span> <span class="n">move_camera_up</span><span class="p">,</span> <span class="n">move_camera_down</span>
<span class="kn">from</span> <span class="nn">data.Artifacts</span> <span class="kn">import</span> <span class="n">Artifact</span>
<span class="kn">from</span> <span class="nn">data.creature_banks</span> <span class="kn">import</span> <span class="n">Creature_Bank</span>
<span class="kn">from</span> <span class="nn">data.habitats_on_map</span> <span class="kn">import</span> <span class="n">Habitat_On_Map</span>
<span class="kn">from</span> <span class="nn">data.hero</span> <span class="kn">import</span> <span class="n">Slot</span>
<span class="kn">from</span> <span class="nn">data.objects_on_map</span> <span class="kn">import</span> <span class="n">Treasure_Chest</span><span class="p">,</span> <span class="n">DissapearOnClick</span><span class="p">,</span> <span class="n">LuckMorale</span><span class="p">,</span> <span class="n">ObjectOnMap</span>
<span class="kn">from</span> <span class="nn">data.resources</span> <span class="kn">import</span> <span class="n">Resource</span>
<span class="kn">from</span> <span class="nn">image_processing.adventure_image_processing</span> <span class="kn">import</span> <span class="n">detect_thing_ocr</span><span class="p">,</span> <span class="n">find_heroes</span><span class="p">,</span> <span class="n">detect_hero_move</span>
<span class="kn">from</span> <span class="nn">image_processing.screen_slicing</span> <span class="kn">import</span> <span class="n">ScreenStorage</span>
<span class="kn">from</span> <span class="nn">data.player_data</span> <span class="kn">import</span> <span class="n">Player</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="c1"># Hierarchy function imports</span>
<span class="kn">import</span> <span class="nn">hierarchyFunctions.miscFunc</span> <span class="k">as</span> <span class="nn">misC</span>
<span class="kn">import</span> <span class="nn">hierarchyFunctions.artifact_value</span> <span class="k">as</span> <span class="nn">artval</span>
<span class="kn">import</span> <span class="nn">hierarchyFunctions.creature_banks_value</span> <span class="k">as</span> <span class="nn">bankval</span>
<span class="kn">import</span> <span class="nn">hierarchyFunctions.enter_city_value</span> <span class="k">as</span> <span class="nn">cityval</span>
<span class="kn">import</span> <span class="nn">hierarchyFunctions.explorationBoost</span> <span class="k">as</span> <span class="nn">fowVal</span>
<span class="kn">import</span> <span class="nn">hierarchyFunctions.neutral_enemies_value</span> <span class="k">as</span> <span class="nn">cval</span>
<span class="kn">import</span> <span class="nn">hierarchyFunctions.mines_and_resources_value</span> <span class="k">as</span> <span class="nn">resourceval</span>
<span class="kn">import</span> <span class="nn">hierarchyFunctions.habitats_value_evaluation</span> <span class="k">as</span> <span class="nn">habitats</span>
<span class="kn">import</span> <span class="nn">hierarchyFunctions.group_value</span> <span class="k">as</span> <span class="nn">group</span>

<span class="kn">from</span> <span class="nn">pathfinding.core.diagonal_movement</span> <span class="kn">import</span> <span class="n">DiagonalMovement</span>
<span class="kn">from</span> <span class="nn">pathfinding.core.grid</span> <span class="kn">import</span> <span class="n">Grid</span>
<span class="kn">from</span> <span class="nn">pathfinding.finder.a_star</span> <span class="kn">import</span> <span class="n">AStarFinder</span>

<span class="kn">from</span> <span class="nn">image_processing.ok_detection</span> <span class="kn">import</span> <span class="n">check_ok</span>
<span class="kn">from</span> <span class="nn">misc.timing</span> <span class="kn">import</span> <span class="n">timing</span>


<div class="viewcode-block" id="findPath"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.findPath">[docs]</a><span class="k">def</span> <span class="nf">findPath</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function which finds path between point A and point B on the specific matrix. Used in costOfThePath() function</span>

<span class="sd">    :param other: point A</span>
<span class="sd">    :param node: point B</span>
<span class="sd">    :param matrix: specific matrix where the path will be found</span>
<span class="sd">    :return: cost of the path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1. Define grid, start point and endpoint</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="p">(</span><span class="n">matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">matrix</span><span class="p">))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># 2. Find a path</span>
    <span class="n">finder</span> <span class="o">=</span> <span class="n">AStarFinder</span><span class="p">(</span><span class="n">diagonal_movement</span><span class="o">=</span><span class="n">DiagonalMovement</span><span class="o">.</span><span class="n">always</span><span class="p">)</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">runs</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">find_path</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1000000</span>

    <span class="c1"># 3. Calculate cost of the path</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">path</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">path</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">path</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">cost</span> <span class="o">+=</span> <span class="mi">141</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cost</span> <span class="o">+=</span> <span class="mi">100</span>

    <span class="k">return</span> <span class="n">cost</span></div>


<div class="viewcode-block" id="tileInControlZone"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.tileInControlZone">[docs]</a><span class="k">def</span> <span class="nf">tileInControlZone</span><span class="p">(</span><span class="n">tilePos</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">objMatrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function which tests whether specific coordinate is located in the interior of the control zone. It investigates</span>
<span class="sd">    neighbours of the tested coordinate and looks for Slot class objects (neutral monsters)</span>

<span class="sd">    :param tilePos: coordinates of the tested point</span>
<span class="sd">    :param objMatrix: matrix which contains information about all the objects on the map</span>
<span class="sd">    :return: boolean value about being or not being in control zone</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">takeSquareAroundXYinRange</span><span class="p">(</span><span class="n">tilePos</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">objMatrix</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="n">Slot</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tilePos</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="costOfThePath"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.costOfThePath">[docs]</a><span class="k">def</span> <span class="nf">costOfThePath</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">goal</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">heroesOnMap</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function which calculates cost of the path from point A to point B on specific matrix. This function contains</span>
<span class="sd">    preparations for using findPath function.</span>

<span class="sd">    :param start: point A</span>
<span class="sd">    :param goal: point B</span>
<span class="sd">    :param heroesOnMap: list with all the heroes on the map (we need to treat them like an obstacle)</span>
<span class="sd">    :param matrix: specific matrix where path will be found</span>
<span class="sd">    :return cost: integer value which is movement cost a hero need to bear to get to the goal point</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Border cases</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">goal</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">tileInControlZone</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span> <span class="n">matrix</span><span class="o">.</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">3000000</span>
    <span class="c1"># TODO temporary solution for fountains (we need to visit it from the specific side (bottom side))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">goal</span><span class="p">],</span> <span class="n">LuckMorale</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">goal</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Fountain_of_Fortune&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">40000</span>

    <span class="c1"># 1. Remember original values of the matrix in *node* and *other* points</span>
    <span class="n">originalNodeValue</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">goal</span><span class="p">]</span>
    <span class="n">originalOtherValue</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>

    <span class="c1"># 2. Set positions occupied by heroes to obstacle (on pathfinding matrix)</span>
    <span class="k">for</span> <span class="n">hero</span> <span class="ow">in</span> <span class="n">heroesOnMap</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">hero</span><span class="o">.</span><span class="n">position</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># 3. Change values in the matrix in *node* and *other* points to one (we need to can reach these points)</span>
    <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">goal</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># 4. If its cost to the monster, delete its control zone</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">takeSquareAroundXYinRange</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">goal</span><span class="p">],</span> <span class="n">Slot</span><span class="p">):</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">controlZones</span><span class="p">[</span><span class="n">goal</span><span class="p">]</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">goal</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># 5. Calculate cost with prepared matrix</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">findPath</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">goal</span><span class="p">,</span> <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">)</span>

    <span class="c1"># 6. If its cost to the monster, switchback control zone</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">goal</span><span class="p">],</span> <span class="n">Slot</span><span class="p">):</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># 7. Turn back heroes position to 1 on maskMap</span>
    <span class="k">for</span> <span class="n">hero</span> <span class="ow">in</span> <span class="n">heroesOnMap</span><span class="p">:</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">hero</span><span class="o">.</span><span class="n">position</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># 8. Switchback matrix in *node* and *other* points to their original values</span>
    <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">goal</span><span class="p">]</span> <span class="o">=</span> <span class="n">originalNodeValue</span>
    <span class="n">matrix</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">originalOtherValue</span>
    <span class="k">return</span> <span class="n">cost</span></div>


<div class="viewcode-block" id="takeSquareAroundXYinRange"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.takeSquareAroundXYinRange">[docs]</a><span class="k">def</span> <span class="nf">takeSquareAroundXYinRange</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">squareRange</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function which takes square area around specific coordinates in specific range. It returns list=[x1, x2, y1, y2]</span>
<span class="sd">    where (x1, y1) is left up corner of the area and (x2, y2) is right down corner of the area. It pays attention to map</span>
<span class="sd">    boundaries. Works only for 72x72 arrays.</span>

<span class="sd">    :param xy: center of the square area</span>
<span class="sd">    :param squareRange: (a - 1)/2 of the square where a is square&#39;s side&#39;s length.</span>
<span class="sd">    :return: list with coordinates where (x1, y1) is left up corner of the area and (x2, y2) is right down corner of the area</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">squareRange</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">squareRange</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="mi">72</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">squareRange</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">72</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">squareRange</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">squareRange</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">squareRange</span><span class="p">)</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="mi">72</span> <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">squareRange</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">72</span> <span class="k">else</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">squareRange</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span></div>


<div class="viewcode-block" id="getSquareFromMatrix"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.getSquareFromMatrix">[docs]</a><span class="k">def</span> <span class="nf">getSquareFromMatrix</span><span class="p">(</span><span class="n">squareCoord</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns numpy array fragment of another numpy array from given left up (x1, y1) and right down (x2, y2) corners of</span>
<span class="sd">    the area.</span>

<span class="sd">    :param squareCoord: list with coordinates [x1, x2, y1, y2]</span>
<span class="sd">    :param matrix: numpy array from which we want to cut some square area</span>
<span class="sd">    :return: numpy area which is fragment of the matrix param</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">matrix</span><span class="p">[</span><span class="n">squareCoord</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">squareCoord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">squareCoord</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">squareCoord</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span></div>


<div class="viewcode-block" id="calculateFinalValue"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.calculateFinalValue">[docs]</a><span class="k">def</span> <span class="nf">calculateFinalValue</span><span class="p">(</span><span class="n">itm</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">itm</span><span class="o">.</span><span class="n">val</span> <span class="o">/</span> <span class="p">(</span><span class="n">itm</span><span class="o">.</span><span class="n">cost</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="getNextBestTarget"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.getNextBestTarget">[docs]</a><span class="k">def</span> <span class="nf">getNextBestTarget</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function which appoints next best goal from list of goals. The best goal is the goal with biggest difference between</span>
<span class="sd">    value of the goal and its path cost.</span>

<span class="sd">    :param items: list of goals</span>
<span class="sd">    :return: best goal</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">itemsCopy</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">itemsCopy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">itm</span><span class="p">:</span> <span class="n">calculateFinalValue</span><span class="p">(</span><span class="n">itm</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># On the sorted list we are now looking for target with value greater than zero and cost less than 50000</span>
    <span class="k">for</span> <span class="n">goal</span> <span class="ow">in</span> <span class="n">itemsCopy</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">goal</span><span class="o">.</span><span class="n">val</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">goal</span><span class="o">.</span><span class="n">cost</span> <span class="o">&lt;</span> <span class="mi">50000</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[CHOSEN TARGET]&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    COORD: </span><span class="si">{</span><span class="n">goal</span><span class="o">.</span><span class="n">co_ordinates</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    VALUE: </span><span class="si">{</span><span class="n">goal</span><span class="o">.</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    COST: </span><span class="si">{</span><span class="n">goal</span><span class="o">.</span><span class="n">cost</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    FINAL VALUE: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">calculateFinalValue</span><span class="p">(</span><span class="n">goal</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">goal</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[NO TARGET CHOSEN]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="Item"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.Item">[docs]</a><span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">cost</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dataclass of the goal. It has information about coordinates of the goal, its value and cost to it</span>

<span class="sd">        :param coord:</span>
<span class="sd">        :param val:</span>
<span class="sd">        :param cost:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">co_ordinates</span> <span class="o">=</span> <span class="n">coord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_val</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">cost</span>

<div class="viewcode-block" id="Item.getValue"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.Item.getValue">[docs]</a>    <span class="k">def</span> <span class="nf">getValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns value of the Item (goal)</span>

<span class="sd">        :return value:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span></div>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">co_ordinates</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">co_ordinates</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span></div>


<div class="viewcode-block" id="MapData"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.MapData">[docs]</a><span class="k">class</span> <span class="nc">MapData</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MapData is a class where the information about objects, discovered tiles, pathfinding mask (maskMap) and</span>
<span class="sd">        control zones of the creatures are stored</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Init objMap with all the objects at the map (habitats, castles, monsters, free spaces like grass and dirt)</span>
        <span class="c1"># and init fowMap with all the discovered tiles (1 means tile is discovered, 0 means it is under fow of war)</span>
        <span class="c1"># heroesMap contains information about positions of the heroes at the whole map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">initMap</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heroes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Create maskMap for A* algorithm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maskMap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controlZones</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># We need to pay attention to control zone of the neutral monsters</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">72</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">72</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># Init control zone of the monster</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">controlZones</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">([])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fillControlZones</span><span class="p">()</span>

<div class="viewcode-block" id="MapData.fillControlZones"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.MapData.fillControlZones">[docs]</a>    <span class="k">def</span> <span class="nf">fillControlZones</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which fills initialized control zones of the monsters at the map. We need to remember state of the</span>
<span class="sd">        control zones for pathfinding algorithm. Control zone is like obstacle at the maskMap (map for pathfinding),</span>
<span class="sd">        but is changing in remembered state when we are moving to the neutral creature which is owner of this control</span>
<span class="sd">        zone.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Remember area without control zone and put control zone to maskMap array</span>
        <span class="c1"># We will be deleting control zone always when calculating cost to the neutral mob and always when we beat</span>
        <span class="c1"># the monster</span>
        <span class="k">for</span> <span class="n">monsterPosKey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controlZones</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Returns list with two points: left up corner and right down corner</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">takeSquareAroundXYinRange</span><span class="p">(</span><span class="n">monsterPosKey</span><span class="p">)</span>

            <span class="c1"># Returns area of a matrix with given left up and right down corners list</span>
            <span class="n">area</span> <span class="o">=</span> <span class="n">getSquareFromMatrix</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskMap</span><span class="p">)</span>

            <span class="c1"># Remember this area and set maskMap for this range to zeros</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controlZones</span><span class="p">[</span><span class="n">monsterPosKey</span><span class="p">]</span> <span class="o">=</span> <span class="n">area</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span></div></div>


<div class="viewcode-block" id="AdventureAI"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI">[docs]</a><span class="k">class</span> <span class="nc">AdventureAI</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playerClass</span><span class="p">:</span> <span class="n">Player</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        AdventureAI class is responsible for moving hero on adventure map, choosing goals and doing actions like</span>
<span class="sd">        collecting resources etc.</span>

<span class="sd">        :param playerClass: player object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">next_hero</span><span class="p">()</span>
        <span class="c1"># Utility needs for the adventure AI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="n">ScreenStorage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">playerClass</span>

        <span class="c1"># Creating map instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">MapData</span><span class="p">()</span>

        <span class="c1"># Here we dynamically store graph with information about possible targets to choose by the heroes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goals</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Heroes list contains allied Hero instances, heroPointer is used for handling currentHero who we choose in</span>
        <span class="c1"># game at the right part of the game window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heroes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">heroes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heroPointer</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># We need to remember enemy coordinates, because we need to actualize their position in goals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enemyCoordinates</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initStartHeroPosition</span><span class="p">()</span>

<div class="viewcode-block" id="AdventureAI.initStartHeroPosition"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.initStartHeroPosition">[docs]</a>    <span class="k">def</span> <span class="nf">initStartHeroPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which initializing start position of the hero at the start of the game</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Find hero starting position</span>
        <span class="n">next_hero</span><span class="p">()</span>
        <span class="n">heroes</span> <span class="o">=</span> <span class="n">find_heroes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>

        <span class="c1"># 2. Set this position to the hero and actualize camera position</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">heroes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heroes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">heroes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heroPointer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># 3. Discover our initial city, append it to goals and actualize obj map</span>
        <span class="n">castle</span> <span class="o">=</span> <span class="n">detect_thing_ocr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="s2">&quot;Castle&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">cities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">castle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">castle</span>

        <span class="c1"># 4. Discover the rest of the area around the hero initial position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discoverAreaAroundXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">position</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdventureAI.cameraOnCurrentHero"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.cameraOnCurrentHero">[docs]</a>    <span class="k">def</span> <span class="nf">cameraOnCurrentHero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which centers camera to the current hero</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">camera</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">position</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">position</span>
            <span class="n">center_on_hero</span><span class="p">()</span></div>

<div class="viewcode-block" id="AdventureAI.discoverAreaAroundXY"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.discoverAreaAroundXY">[docs]</a>    <span class="k">def</span> <span class="nf">discoverAreaAroundXY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which discovers circular area around specific coord at the map</span>

<span class="sd">        :param xy: center of discovered area</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="c1"># # 2.1 Define variables which create area to discover (square from (x1, y1) to (x2, y2) + small areas around</span>
        <span class="c1"># # this square)</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">5</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">6</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">5</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">6</span>
        <span class="k">if</span> <span class="n">x1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">mx1</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">-</span> <span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mx1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">x2</span> <span class="o">&gt;</span> <span class="mi">72</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="mi">72</span>
            <span class="n">mx2</span> <span class="o">=</span> <span class="mi">66</span> <span class="o">-</span> <span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mx2</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="k">if</span> <span class="n">y1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">my1</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">-</span> <span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">my1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">72</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="mi">72</span>
            <span class="n">my2</span> <span class="o">=</span> <span class="mi">66</span> <span class="o">-</span> <span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">my2</span> <span class="o">=</span> <span class="mi">11</span>

        <span class="c1"># Mask defines shape of the discovered area</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])))</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="n">mx1</span><span class="p">:</span><span class="n">mx2</span><span class="p">,</span> <span class="n">my1</span><span class="p">:</span><span class="n">my2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
                <span class="c1"># Check only tiles from mask (it defines shape of the discovered area)</span>
                <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">cx</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">y1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">fog</span><span class="p">[</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">fog</span><span class="p">[</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">detectXY</span><span class="p">((</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">))</span>

        <span class="c1"># checking the borders and eventually adding goals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discoveryValue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discoveryValue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discoveryValue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discoveryValue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdventureAI.detectXY"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.detectXY">[docs]</a>    <span class="k">def</span> <span class="nf">detectXY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which are detecting specific tile on the map. Using OCR</span>

<span class="sd">        :param target: (coordinates of tile)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Only int type objects we need to detect with tesseract</span>
        <span class="c1"># (check AdventureAI_Map_Init for more info)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">detectDwelling</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">detectAnotherObjects</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">Habitat_On_Map</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Item</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>

<div class="viewcode-block" id="AdventureAI.detectDwelling"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.detectDwelling">[docs]</a>    <span class="k">def</span> <span class="nf">detectDwelling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detection function for random dwellings. Used in detectXY function.</span>

<span class="sd">        :param target: (coordinates of tile)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Detect dwelling type and test if we are detecting left or right side of the building</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">target</span>
        <span class="n">thing</span> <span class="o">=</span> <span class="n">detect_thing_ocr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="s2">&quot;Building&quot;</span><span class="p">)</span>

        <span class="c1"># 2. Determining whether detected part of the building is left</span>
        <span class="c1"># Boundary cases</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">71</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
        <span class="c1"># Usual cases</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>

        <span class="c1"># If we detected left side of the building</span>
        <span class="k">if</span> <span class="n">part</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
            <span class="c1"># If entrance is on the left side we can add this building to goals</span>
            <span class="k">if</span> <span class="n">thing</span><span class="o">.</span><span class="n">entrance</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">thing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Item</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="c1"># Otherwise (entrance is on the right side) we need to check whether right side of the building is</span>
            <span class="c1"># discovered. If is not, we cannot add this building to goals</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">fog</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">thing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Item</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># If we detected right side of the building</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If entrance is on the right side we can add this building to goals</span>
            <span class="k">if</span> <span class="n">thing</span><span class="o">.</span><span class="n">entrance</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">thing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Item</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="c1"># Otherwise (entrance is on the left side) we need to check whether left side of the building is</span>
            <span class="c1"># discovered. If is not, we cannot add this building to goals</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">fog</span><span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">thing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Item</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>

<div class="viewcode-block" id="AdventureAI.detectAnotherObjects"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.detectAnotherObjects">[docs]</a>    <span class="k">def</span> <span class="nf">detectAnotherObjects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detection function for all random things which are not random dwellings. Used in detectXY function.</span>

<span class="sd">        :param target: (coordinates of tile)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 0, 1, 2 are undetectable (obstacles and empty spaces)</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># 8 on map is equal to Treasure Chest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">Treasure_Chest</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Item</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># 1. Detect what is it with OCR</span>
        <span class="n">argDictionary</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;Resource&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;Castle&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;Creature&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="s2">&quot;Artifact&quot;</span><span class="p">}</span>
        <span class="n">thing</span> <span class="o">=</span> <span class="n">detect_thing_ocr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">argDictionary</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">]])</span>

        <span class="c1"># 2. Add detected thing to goals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">thing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Item</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>

<div class="viewcode-block" id="AdventureAI.discoveryValue"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.discoveryValue">[docs]</a>    <span class="k">def</span> <span class="nf">discoveryValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which adds exploration goals to the list with goals</span>

<span class="sd">        :param x:</span>
<span class="sd">        :param y:</span>
<span class="sd">        :param x1:</span>
<span class="sd">        :param top:</span>
<span class="sd">        :param bottom:</span>
<span class="sd">        :param left:</span>
<span class="sd">        :param right:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check borders for exploring</span>
        <span class="c1"># discovery goal value</span>
        <span class="n">discoveryBonus</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">undiscovered</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># depending on the border to be checked the variables change</span>
        <span class="n">border</span> <span class="o">=</span> <span class="n">xvar1</span> <span class="o">=</span> <span class="n">xvar2</span> <span class="o">=</span> <span class="n">yvar1</span> <span class="o">=</span> <span class="n">yvar2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">left</span><span class="p">:</span>
            <span class="n">border</span><span class="p">,</span> <span class="n">xvar1</span><span class="p">,</span> <span class="n">xvar2</span><span class="p">,</span> <span class="n">yvar1</span><span class="p">,</span> <span class="n">yvar2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">right</span><span class="p">:</span>
            <span class="n">border</span><span class="p">,</span> <span class="n">xvar1</span><span class="p">,</span> <span class="n">xvar2</span><span class="p">,</span> <span class="n">yvar1</span><span class="p">,</span> <span class="n">yvar2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">top</span><span class="p">:</span>
            <span class="n">border</span><span class="p">,</span> <span class="n">xvar1</span><span class="p">,</span> <span class="n">xvar2</span><span class="p">,</span> <span class="n">yvar1</span><span class="p">,</span> <span class="n">yvar2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span>
        <span class="k">if</span> <span class="n">bottom</span><span class="p">:</span>
            <span class="n">border</span><span class="p">,</span> <span class="n">xvar1</span><span class="p">,</span> <span class="n">xvar2</span><span class="p">,</span> <span class="n">yvar1</span><span class="p">,</span> <span class="n">yvar2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span>

        <span class="c1"># gotta make sure to not get out of range</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">border</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">72</span><span class="p">:</span>
            <span class="c1"># we check whether there is undiscovered area around hero</span>
            <span class="k">if</span> <span class="n">left</span> <span class="ow">or</span> <span class="n">right</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">yl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">fog</span><span class="p">[</span><span class="n">x1</span> <span class="o">+</span> <span class="n">border</span><span class="p">,</span> <span class="n">yl</span><span class="p">]:</span>
                        <span class="n">undiscovered</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">xl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">fog</span><span class="p">[</span><span class="n">xl</span><span class="p">,</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">border</span><span class="p">]:</span>
                        <span class="n">undiscovered</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">undiscovered</span><span class="p">:</span>
                <span class="c1"># first we check whether we have any goals near the border that we are checking</span>
                <span class="k">for</span> <span class="n">xl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">xvar1</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">xvar2</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">yl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">yvar1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">yvar2</span><span class="p">):</span>
                        <span class="c1"># if we have a goal there, we will go there eventually so no need to add anything</span>
                        <span class="k">if</span> <span class="n">Item</span><span class="p">((</span><span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="p">:</span>
                            <span class="k">return</span> <span class="mi">0</span>
                <span class="c1"># if we got here, it means we have no goals near fogged area</span>
                <span class="k">for</span> <span class="n">xl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">xvar1</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">xvar2</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">yl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">yvar1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">yvar2</span><span class="p">):</span>
                        <span class="c1"># check whether we can walk there</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="c1"># add a new goal to discover the area</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Item</span><span class="p">((</span><span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                            <span class="n">coord</span> <span class="o">=</span> <span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DISCOVERY TARGET] </span><span class="si">{</span><span class="n">coord</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">discoveryBonus</span><span class="p">,</span> <span class="n">coord</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="AdventureAI.currHero"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.currHero">[docs]</a>    <span class="k">def</span> <span class="nf">currHero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which get current hero</span>

<span class="sd">        :return Hero which is pointed by heroPointer:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heroes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">heroPointer</span><span class="p">]</span></div>

<div class="viewcode-block" id="AdventureAI.moveCurrentHero"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.moveCurrentHero">[docs]</a>    <span class="k">def</span> <span class="nf">moveCurrentHero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which moves current hero to specific target. It testing whether we are already at the destination</span>
<span class="sd">        tile or not and clicks on map to move on specific tile</span>

<span class="sd">        :param target: coordinates of specific tile</span>
<span class="sd">        :return 0 if we are already on specific tile and we do not need to move, else None:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Making move in game if we are not at target tile</span>
        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">position</span>  <span class="c1"># We need target relative to hero position for GUI_handling correct work</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deleteGoal</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">25</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cy</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moveCameraToTarget</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="n">camX</span><span class="p">,</span> <span class="n">camY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">camera</span>
        <span class="n">move_to_tile_adventure</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">camX</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">camY</span><span class="p">)</span>

        <span class="c1"># 2. Wait for end of the move animation, then discover area around this target tile</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AdventureAI.assignValueToTile"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.assignValueToTile">[docs]</a>    <span class="k">def</span> <span class="nf">assignValueToTile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which returns value of specific tile at the map. Value is used for choosing best target to visit</span>

<span class="sd">        :param node: coordinates of tile</span>
<span class="sd">        :return value: value assigned to this tile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
        <span class="c1"># If hero is not our main hero and the target is Slot make this target invaluable</span>
        <span class="k">if</span> <span class="n">hero</span><span class="o">.</span><span class="n">herotype</span> <span class="o">!=</span> <span class="s2">&quot;main&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Slot</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Creature_Bank</span><span class="p">)):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>


        <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="n">misC</span><span class="o">.</span><span class="n">mp</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">hero</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="n">misC</span><span class="o">.</span><span class="n">disappear_on_click</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">hero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="n">misC</span><span class="o">.</span><span class="n">increase_skills</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">hero</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="n">misC</span><span class="o">.</span><span class="n">luck_morale</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">hero</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="n">misC</span><span class="o">.</span><span class="n">the_rest</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">hero</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Artifact</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="n">artval</span><span class="o">.</span><span class="n">artifact_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">hero</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Creature_Bank</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="n">bankval</span><span class="o">.</span><span class="n">creature_bank_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">hero</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">+=</span> <span class="n">cityval</span><span class="o">.</span><span class="n">enter_city_evaluation</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">hero</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">+=</span> <span class="n">fowVal</span><span class="o">.</span><span class="n">evaluateExplorationBoost</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">+=</span> <span class="n">cval</span><span class="o">.</span><span class="n">neutral_enemies_value</span><span class="p">(</span><span class="n">hero</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">+=</span> <span class="n">resourceval</span><span class="o">.</span><span class="n">mineCase</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="n">resourceval</span><span class="o">.</span><span class="n">resourceStackCase</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">hero</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Habitat_On_Map</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="n">habitats</span><span class="o">.</span><span class="n">habitat_on_map_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">hero</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="AdventureAI.assign_temp_value_group"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.assign_temp_value_group">[docs]</a>    <span class="k">def</span> <span class="nf">assign_temp_value_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assigns temporal value to tiles, it needs to be temporal because if it was straight up added it would</span>
<span class="sd">        artificially increase the value of the tiles surrounding it</span>

<span class="sd">        :param node: coordinates of the tile being checked</span>
<span class="sd">        :return: temporal value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">group_value</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">hero</span><span class="o">.</span><span class="n">value_map</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="AdventureAI.actualizeCurrHeroPosXDXDXDXDXDXD"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.actualizeCurrHeroPosXDXDXDXDXDXD">[docs]</a>    <span class="k">def</span> <span class="nf">actualizeCurrHeroPosXDXDXDXDXDXD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function find heroes positions at the map and actualize their positions</span>

<span class="sd">        :return: (x, y), position of the hero</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Actualize position of camera and currentHero</span>
        <span class="c1"># heroes = find_heroes(self.screen)</span>

        <span class="c1"># Bug fix to always find our hero (currently works only for one hero)</span>
        <span class="c1"># while not heroes:</span>
        <span class="c1">#     next_hero()</span>
        <span class="c1">#     heroes = find_heroes(self.screen)</span>

        <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="o">=</span> <span class="n">detect_hero_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[HERO MOVE] </span><span class="si">{</span><span class="n">old</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="AdventureAI.actualizeCurrHeroPos"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.actualizeCurrHeroPos">[docs]</a>    <span class="k">def</span> <span class="nf">actualizeCurrHeroPos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Actualize position of camera and currentHero</span>
        <span class="n">heroes</span> <span class="o">=</span> <span class="n">find_heroes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>

        <span class="c1"># Bug fix to always find our hero (currently works only for one hero)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">heroes</span><span class="p">:</span>
            <span class="n">next_hero</span><span class="p">()</span>
            <span class="n">heroes</span> <span class="o">=</span> <span class="n">find_heroes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">heroes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="s2">&quot;Red&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>

<div class="viewcode-block" id="AdventureAI.playHeroDay"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.playHeroDay">[docs]</a>    <span class="k">def</span> <span class="nf">playHeroDay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which play one turn for current hero. It does multiple moves till hero has no movement points</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[CURRENT HERO] ------------------------------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    NAME: </span><span class="si">{</span><span class="n">hero</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    POSITION: </span><span class="si">{</span><span class="n">hero</span><span class="o">.</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    MS POINTS: </span><span class="si">{</span><span class="n">hero</span><span class="o">.</span><span class="n">mspoints</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">death</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># 1. At the start of the day we are adding detected enemies to goals</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heroPointer</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addEnemiesToGoals</span><span class="p">()</span>

        <span class="c1"># 2. Executing whole hero day</span>
        <span class="k">while</span> <span class="n">hero</span><span class="o">.</span><span class="n">mspoints</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">death</span><span class="p">:</span>
            <span class="n">earlier</span> <span class="o">=</span> <span class="n">image_processing</span><span class="o">.</span><span class="n">adventure_image_processing</span><span class="o">.</span><span class="n">check_if_hero_is_dead_first</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nextMove</span><span class="p">()</span>
            <span class="n">death</span> <span class="o">=</span> <span class="n">image_processing</span><span class="o">.</span><span class="n">adventure_image_processing</span><span class="o">.</span><span class="n">check_if_hero_is_dead_last</span><span class="p">(</span><span class="n">earlier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">hero</span><span class="p">)</span>

        <span class="c1"># 3. After moving last hero we are deleting detected enemies from goals</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heroPointer</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heroes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delEnemiesFromGoals</span><span class="p">()</span></div>

<div class="viewcode-block" id="AdventureAI.addEnemiesToGoals"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.addEnemiesToGoals">[docs]</a>    <span class="k">def</span> <span class="nf">addEnemiesToGoals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which adds enemy heroes position to the list with goals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">enemyHero</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">enemies</span><span class="p">:</span>
            <span class="n">goal</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">enemyHero</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enemyCoordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goal</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdventureAI.delEnemiesFromGoals"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.delEnemiesFromGoals">[docs]</a>    <span class="k">def</span> <span class="nf">delEnemiesFromGoals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which deletes enemy heroes position from the list with goals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allTheGoals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">goal</span> <span class="ow">in</span> <span class="n">allTheGoals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">goal</span><span class="o">.</span><span class="n">co_ordinates</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">enemyCoordinates</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdventureAI.checkNotResourceDestinationSuccess"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.checkNotResourceDestinationSuccess">[docs]</a>    <span class="k">def</span> <span class="nf">checkNotResourceDestinationSuccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Not resource case for testing if hero have got to the given target or not</span>

<span class="sd">        :param target: coordinates of the tile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">okay</span> <span class="o">=</span> <span class="n">check_ok</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">okay</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">okay</span> <span class="o">=</span> <span class="n">check_ok</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OKAY VALUE: </span><span class="si">{</span><span class="n">okay</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">okay</span><span class="p">:</span>
            <span class="c1"># Do action assigned to the object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">(),</span> <span class="n">okay</span><span class="p">)</span>

            <span class="c1"># We achieved the goal so delete it from goals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deleteGoal</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">DissapearOnClick</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">Slot</span><span class="p">):</span>
                <span class="c1"># Actualize mask map if goal is disappear on click object</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">actualizeMaskMap</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdventureAI.checkResourceDestinationSuccess"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.checkResourceDestinationSuccess">[docs]</a>    <span class="k">def</span> <span class="nf">checkResourceDestinationSuccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resource case for testing if hero have got to the given target or not</span>

<span class="sd">        :param target: coordinates of the tile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actualizeCurrHeroPosXDXDXDXDXDXD</span><span class="p">()</span>
        <span class="n">thing</span> <span class="o">=</span> <span class="n">detect_thing_ocr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="s2">&quot;Resource&quot;</span><span class="p">,</span> <span class="n">drillMouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">Resource</span><span class="p">):</span>
            <span class="c1"># Do action assigned to the object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    RESOURCES TAKEN&#39;</span><span class="p">)</span>

            <span class="c1"># We achieved the goal so delete it from goals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deleteGoal</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

            <span class="c1"># Actualize mask map</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actualizeMaskMap</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdventureAI.checkEmptyDestinationSuccess"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.checkEmptyDestinationSuccess">[docs]</a>    <span class="k">def</span> <span class="nf">checkEmptyDestinationSuccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Empty space (exploration goals) case for tmesting if hero have got to the given target or not</span>

<span class="sd">        :param target: coordinates of the tile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">heroPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actualizeCurrHeroPosXDXDXDXDXDXD</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="n">heroPos</span><span class="p">:</span>
            <span class="c1"># We achieved the goal so delete it from goals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deleteGoal</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[EMPTY DESTINATION CHECK]:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    HERO POS: </span><span class="si">{</span><span class="n">heroPos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    TARGET POS: </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdventureAI.actualizeMaskMap"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.actualizeMaskMap">[docs]</a>    <span class="k">def</span> <span class="nf">actualizeMaskMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If we pick up the resource we need to actualize mask map (for pathfinding), this function do it</span>

<span class="sd">        :param target: coordinates of the tile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">Resource</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">DissapearOnClick</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">Slot</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">takeSquareAroundXYinRange</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">controlZones</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">maskMap</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="AdventureAI.nextMove"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.nextMove">[docs]</a>    <span class="k">def</span> <span class="nf">nextMove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which move current hero to the best target</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span>

        <span class="c1"># 1 Firstly we need to actualize values of the nodes in targets graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actualizeValueAndCostsToGoals</span><span class="p">()</span>

        <span class="c1"># 2. Then we get best possible target</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">getNextBestTarget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="p">)</span>
        <span class="c1"># If target == 0 we do not have any good target to choose so we do nothing :)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">hero</span><span class="o">.</span><span class="n">mspoints</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printTarget</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="c1"># 3. Move current hero</span>
        <span class="n">moved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveCurrentHero</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">moved</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># 3.1 Checking destination success, if success do action</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">],</span> <span class="n">Resource</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkResourceDestinationSuccess</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkNotResourceDestinationSuccess</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actualizeCurrHeroPosXDXDXDXDXDXD</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkEmptyDestinationSuccess</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># 4. Actualize hero movement points and discover area around the him</span>
        <span class="n">hero</span><span class="o">.</span><span class="n">mspoints</span> <span class="o">-=</span> <span class="n">target</span><span class="o">.</span><span class="n">cost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discoverAreaAroundXY</span><span class="p">(</span><span class="n">hero</span><span class="o">.</span><span class="n">position</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdventureAI.deleteGoal"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.deleteGoal">[docs]</a>    <span class="k">def</span> <span class="nf">deleteGoal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which deletes specific target. It is called only when we have got to the specific goal</span>

<span class="sd">        :param target: coordinates of the tile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">goal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="n">goal</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="k">break</span></div>

<div class="viewcode-block" id="AdventureAI.actualizeValueAndCostsToGoals"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.actualizeValueAndCostsToGoals">[docs]</a>    <span class="k">def</span> <span class="nf">actualizeValueAndCostsToGoals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which actualize value of goals and costs to these goals. Called always before calling nextMove()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">heroPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">position</span>
        <span class="k">for</span> <span class="n">goal</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="p">:</span>
            <span class="n">goal</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">costOfThePath</span><span class="p">(</span><span class="n">heroPos</span><span class="p">,</span> <span class="n">goal</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">heroes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span>
            <span class="n">goal</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignValueToTile</span><span class="p">(</span><span class="n">goal</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">value_map</span><span class="p">[</span><span class="n">goal</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">]</span> <span class="o">=</span> <span class="n">goal</span><span class="o">.</span><span class="n">val</span>
        <span class="k">for</span> <span class="n">goal</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="p">:</span>
            <span class="n">goal</span><span class="o">.</span><span class="n">temp_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_temp_value_group</span><span class="p">(</span><span class="n">goal</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">temp_value_map</span><span class="p">[</span><span class="n">goal</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">]</span> <span class="o">=</span> <span class="n">goal</span><span class="o">.</span><span class="n">temp_val</span>

        <span class="k">for</span> <span class="n">goal</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="p">:</span>
            <span class="n">goal</span><span class="o">.</span><span class="n">val</span> <span class="o">+=</span> <span class="n">goal</span><span class="o">.</span><span class="n">temp_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">value_map</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">temp_value_map</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[TARGETS]&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="p">:</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="s2">&quot;Discovery target&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">],</span> <span class="n">Slot</span><span class="p">):</span>
                    <span class="n">thing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">thing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span> <span class="n">calculateFinalValue</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">thing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdventureAI.printTarget"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.printTarget">[docs]</a>    <span class="k">def</span> <span class="nf">printTarget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for printing hero&#39;s next target in the console. Used for debugging</span>

<span class="sd">        :param target: coordinates of the tile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">thing</span> <span class="o">=</span> <span class="s2">&quot;Empty space&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">],</span> <span class="n">Slot</span><span class="p">):</span>
                <span class="n">thing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">co_ordinates</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[MOVE FROM A TO B]&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    HERO POSITION: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    HERO MOVEMENT POINTS: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currHero</span><span class="p">()</span><span class="o">.</span><span class="n">mspoints</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    TARGET: </span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">co_ordinates</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">thing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdventureAI.addCastlesToGoals"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.addCastlesToGoals">[docs]</a>    <span class="k">def</span> <span class="nf">addCastlesToGoals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">castle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">cities</span><span class="p">:</span>
            <span class="c1"># Add each castle to the goals only if specific castle is not already in goals</span>
            <span class="n">alreadyInGoals</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">goal</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">goal</span><span class="o">.</span><span class="n">co_ordinates</span> <span class="o">==</span> <span class="n">castle</span><span class="o">.</span><span class="n">position</span><span class="p">:</span>
                    <span class="n">alreadyInGoals</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">alreadyInGoals</span><span class="p">:</span>
                <span class="n">castleGoal</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">castle</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">castleGoal</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdventureAI.moveCameraToTarget"><a class="viewcode-back" href="../AdventureAI.html#AdventureAI.AdventureAI.moveCameraToTarget">[docs]</a>    <span class="k">def</span> <span class="nf">moveCameraToTarget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">target</span>
        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">camera</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[CAMERA MOVE]&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    FROM: </span><span class="si">{</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    DESTINATION: </span><span class="si">{</span><span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="n">tx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cy</span> <span class="o">-</span> <span class="n">ty</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cx</span> <span class="o">-</span> <span class="n">tx</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">move_camera_left</span><span class="p">()</span>
                <span class="n">cx</span> <span class="o">-=</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="n">cx</span> <span class="o">-</span> <span class="n">tx</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">move_camera_right</span><span class="p">()</span>
                <span class="n">cx</span> <span class="o">+=</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">ty</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">move_camera_up</span><span class="p">()</span>
                <span class="n">cy</span> <span class="o">-=</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">ty</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">move_camera_down</span><span class="p">()</span>
                <span class="n">cy</span> <span class="o">+=</span> <span class="mi">3</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">homm3-bot</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Fryderyk Rg, Kacper Plesiak, Tymoteusz Skrzyski, Daniel Bil, Micha Gruba, Bartosz Szczepanek, Piotr yczko, Mateusz Mikszewicz, Alan Konopko, Mateusz Comblik.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>